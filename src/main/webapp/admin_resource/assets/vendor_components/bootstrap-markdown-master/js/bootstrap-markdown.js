(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof exports==="object"){a(require("jquery"))}else{a(jQuery)}}}(function(a){var d=function(f,g){var h=["autofocus","savable","hideable","width","height","resize","iconlibrary","language","footer","fullscreen","hiddenButtons","disabledButtons"];a.each(h,function(i,j){if(typeof a(f).data(j)!=="undefined"){g=typeof g=="object"?g:{};g[j]=a(f).data(j)}});this.$ns="bootstrap-markdown";this.$element=a(f);this.$editable={el:null,type:null,attrKeys:[],attrValues:[],content:null};this.$options=a.extend(true,{},a.fn.markdown.defaults,g,this.$element.data("options"));this.$oldContent=null;this.$isPreview=false;this.$isFullscreen=false;this.$editor=null;this.$textarea=null;this.$handler=[];this.$callback=[];this.$nextTab=[];this.showEditor()};d.prototype={constructor:d,__alterButtons:function(i,f){var g=this.$handler,h=(i=="all"),j=this;a.each(g,function(m,n){var l=true;if(h){l=false}else{l=n.indexOf(i)<0}if(l===false){f(j.$editor.find('button[data-handler="'+n+'"]'))}})},__buildButtons:function(q,s){var w,x=this.$ns,t=this.$handler,r=this.$callback;for(w=0;w<q.length;w++){var B,h=q[w];for(B=0;B<h.length;B++){var C,p=h[B].data,g=a("<div/>",{"class":"btn-group"});for(C=0;C<p.length;C++){var k=p[C],l,o,m=x+"-"+k.name,n=this.__getIcon(k.icon),j=k.btnText?k.btnText:"",f=k.btnClass?k.btnClass:"btn",A=k.tabIndex?k.tabIndex:"-1",u=typeof k.hotkey!=="undefined"?k.hotkey:"",v=typeof jQuery.hotkeys!=="undefined"&&u!==""?" ("+u+")":"";l=a("<button></button>");l.text(" "+this.__localize(j)).addClass("btn-default btn-sm").addClass(f);if(f.match(/btn\-(primary|success|info|warning|danger|link)/)){l.removeClass("btn-default")}l.attr({type:"button",title:this.__localize(k.title)+v,tabindex:A,"data-provider":x,"data-handler":m,"data-hotkey":u});if(k.toggle===true){l.attr("data-toggle","button")}o=a("<span/>");o.addClass(n);o.prependTo(l);g.append(l);t.push(m);r.push(k.callback)}s.append(g)}}return s},__setListener:function(){var f=typeof this.$textarea.attr("rows")!=="undefined",g=this.$textarea.val().split("\n").length>5?this.$textarea.val().split("\n").length:"5",h=f?this.$textarea.attr("rows"):g;this.$textarea.attr("rows",h);if(this.$options.resize){this.$textarea.css("resize",this.$options.resize)}this.$textarea.on({focus:a.proxy(this.focus,this),keyup:a.proxy(this.keyup,this),change:a.proxy(this.change,this),select:a.proxy(this.select,this)});if(this.eventSupported("keydown")){this.$textarea.on("keydown",a.proxy(this.keydown,this))}if(this.eventSupported("keypress")){this.$textarea.on("keypress",a.proxy(this.keypress,this))}this.$textarea.data("markdown",this)},__handle:function(i){var l=a(i.currentTarget),j=this.$handler,f=this.$callback,k=l.attr("data-handler"),h=j.indexOf(k),g=f[h];a(i.currentTarget).focus();g(this);this.change(this);if(k.indexOf("cmdSave")<0){this.$textarea.focus()}i.preventDefault()},__localize:function(h){var g=a.fn.markdown.messages,f=this.$options.language;if(typeof g!=="undefined"&&typeof g[f]!=="undefined"&&typeof g[f][h]!=="undefined"){return g[f][h]}return h},__getIcon:function(f){return typeof f=="object"?f[this.$options.iconlibrary]:f},setFullscreen:function(h){var f=this.$editor,g=this.$textarea;if(h===true){f.addClass("md-fullscreen-mode");a("body").addClass("md-nooverflow");this.$options.onFullscreen(this)}else{f.removeClass("md-fullscreen-mode");a("body").removeClass("md-nooverflow");if(this.$isPreview==true){this.hidePreview().showPreview()}}this.$isFullscreen=h;g.focus()},showEditor:function(){var r=this,y,s=this.$ns,h=this.$element,u=h.css("height"),v=h.css("width"),k=this.$editable,p=this.$handler,g=this.$callback,t=this.$options,l=a("<div/>",{"class":"md-editor",click:function(){r.focus()}});if(this.$editor===null){var n=a("<div/>",{"class":"md-header btn-toolbar"});var f=[];if(t.buttons.length>0){f=f.concat(t.buttons[0])}if(t.additionalButtons.length>0){a.each(t.additionalButtons[0],function(A,z){var B=a.grep(f,function(C,D){return C.name===z.name});if(B.length>0){B[0].data=B[0].data.concat(z.data)}else{f.push(t.additionalButtons[0][A])}})}if(t.reorderButtonGroups.length>0){f=f.filter(function(z){return t.reorderButtonGroups.indexOf(z.name)>-1}).sort(function(z,A){if(t.reorderButtonGroups.indexOf(z.name)<t.reorderButtonGroups.indexOf(A.name)){return -1}if(t.reorderButtonGroups.indexOf(z.name)>t.reorderButtonGroups.indexOf(A.name)){return 1}return 0})}if(f.length>0){n=this.__buildButtons([f],n)}if(t.fullscreen.enable){n.append('<div class="md-controls"><a class="md-control md-control-fullscreen" href="#"><span class="'+this.__getIcon(t.fullscreen.icons.fullscreenOn)+'"></span></a></div>').on("click",".md-control-fullscreen",function(z){z.preventDefault();r.setFullscreen(true)})}l.append(n);if(h.is("textarea")){h.before(l);y=h;y.addClass("md-input");l.append(y)}else{var w=(typeof toMarkdown=="function")?toMarkdown(h.html()):h.html(),j=a.trim(w);y=a("<textarea/>",{"class":"md-input",val:j});l.append(y);k.el=h;k.type=h.prop("tagName").toLowerCase();k.content=h.html();a(h[0].attributes).each(function(){k.attrKeys.push(this.nodeName);k.attrValues.push(this.nodeValue)});h.replaceWith(l)}var m=a("<div/>",{"class":"md-footer"}),i=false,o="";if(t.savable){i=true;var x="cmdSave";p.push(x);g.push(t.onSave);m.append('<button class="btn btn-success" data-provider="'+s+'" data-handler="'+x+'"><i class="icon icon-white icon-ok"></i> '+this.__localize("Save")+"</button>")}o=typeof t.footer==="function"?t.footer(this):t.footer;if(a.trim(o)!==""){i=true;m.append(o)}if(i){l.append(m)}if(t.width&&t.width!=="inherit"){if(jQuery.isNumeric(t.width)){l.css("display","table");y.css("width",t.width+"px")}else{l.addClass(t.width)}}if(t.height&&t.height!=="inherit"){if(jQuery.isNumeric(t.height)){var q=t.height;if(n){q=Math.max(0,q-n.outerHeight())}if(m){q=Math.max(0,q-m.outerHeight())}y.css("height",q+"px")}else{l.addClass(t.height)}}this.$editor=l;this.$textarea=y;this.$editable=k;this.$oldContent=this.getContent();this.__setListener();this.$editor.attr("id",(new Date()).getTime());this.$editor.on("click",'[data-provider="bootstrap-markdown"]',a.proxy(this.__handle,this));if(this.$element.is(":disabled")||this.$element.is("[readonly]")){this.$editor.addClass("md-editor-disabled");this.disableButtons("all")}if(this.eventSupported("keydown")&&typeof jQuery.hotkeys==="object"){n.find('[data-provider="bootstrap-markdown"]').each(function(){var z=a(this),A=z.attr("data-hotkey");if(A.toLowerCase()!==""){y.bind("keydown",A,function(){z.trigger("click");return false})}})}if(t.initialstate==="preview"){this.showPreview()}else{if(t.initialstate==="fullscreen"&&t.fullscreen.enable){this.setFullscreen(true)}}}else{this.$editor.show()}if(t.autofocus){this.$textarea.focus();this.$editor.addClass("active")}if(t.fullscreen.enable&&t.fullscreen!==false){this.$editor.append('<div class="md-fullscreen-controls"><a href="#" class="exit-fullscreen" title="Exit fullscreen"><span class="'+this.__getIcon(t.fullscreen.icons.fullscreenOff)+'"></span></a></div>');this.$editor.on("click",".exit-fullscreen",function(z){z.preventDefault();r.setFullscreen(false)})}this.hideButtons(t.hiddenButtons);this.disableButtons(t.disabledButtons);t.onShow(this);return this},parseContent:function(g){var f;var g=g||this.$textarea.val();if(this.$options.parser){f=this.$options.parser(g)}else{if(typeof markdown=="object"){f=markdown.toHTML(g)}else{if(typeof marked=="function"){f=marked(g)}else{f=g}}}return f},showPreview:function(){var j=this.$options,h=this.$textarea,f=h.next(),k=a("<div/>",{"class":"md-preview","data-provider":"markdown-preview"}),i,g;if(this.$isPreview==true){return this}this.$isPreview=true;this.disableButtons("all").enableButtons("cmdPreview");g=j.onPreview(this);i=typeof g=="string"?g:this.parseContent();k.html(i);if(f&&f.attr("class")=="md-footer"){k.insertBefore(f)}else{h.parent().append(k)}k.css({width:h.outerWidth()+"px",height:h.outerHeight()+"px"});if(this.$options.resize){k.css("resize",this.$options.resize)}h.hide();k.data("markdown",this);if(this.$element.is(":disabled")||this.$element.is("[readonly]")){this.$editor.addClass("md-editor-disabled");this.disableButtons("all")}return this},hidePreview:function(){this.$isPreview=false;var f=this.$editor.find('div[data-provider="markdown-preview"]');f.remove();this.enableButtons("all");this.disableButtons(this.$options.disabledButtons);this.$textarea.show();this.__setListener();return this},isDirty:function(){return this.$oldContent!=this.getContent()},getContent:function(){return this.$textarea.val()},setContent:function(f){this.$textarea.val(f);return this},findSelection:function(f){var g=this.getContent(),j;if(j=g.indexOf(f),j>=0&&f.length>0){var h=this.getSelection(),i;this.setSelection(j,j+f.length);i=this.getSelection();this.setSelection(h.start,h.end);return i}else{return null}},getSelection:function(){var f=this.$textarea[0];return(("selectionStart" in f&&function(){var g=f.selectionEnd-f.selectionStart;return{start:f.selectionStart,end:f.selectionEnd,length:g,text:f.value.substr(f.selectionStart,g)}})||function(){return null})()},setSelection:function(h,g){var f=this.$textarea[0];return(("selectionStart" in f&&function(){f.selectionStart=h;f.selectionEnd=g;return})||function(){return null})()},replaceSelection:function(g){var f=this.$textarea[0];return(("selectionStart" in f&&function(){f.value=f.value.substr(0,f.selectionStart)+g+f.value.substr(f.selectionEnd,f.value.length);f.selectionStart=f.value.length;return this})||function(){f.value+=g;return jQuery(f)})()},getNextTab:function(){if(this.$nextTab.length===0){return null}else{var f,g=this.$nextTab.shift();if(typeof g=="function"){f=g()}else{if(typeof g=="object"&&g.length>0){f=g}}return f}},setNextTab:function(h,f){if(typeof h=="string"){var i=this;this.$nextTab.push(function(){return i.findSelection(h)})}else{if(typeof h=="number"&&typeof f=="number"){var g=this.getSelection();this.setSelection(h,f);this.$nextTab.push(this.getSelection());this.setSelection(g.start,g.end)}}return},__parseButtonNameParam:function(f){return typeof f=="string"?f.split(" "):f},enableButtons:function(g){var f=this.__parseButtonNameParam(g),h=this;a.each(f,function(j,k){h.__alterButtons(f[j],function(i){i.removeAttr("disabled")})});return this},disableButtons:function(g){var f=this.__parseButtonNameParam(g),h=this;a.each(f,function(j,k){h.__alterButtons(f[j],function(i){i.attr("disabled","disabled")})});return this},hideButtons:function(g){var f=this.__parseButtonNameParam(g),h=this;a.each(f,function(j,k){h.__alterButtons(f[j],function(i){i.addClass("hidden")})});return this},showButtons:function(g){var f=this.__parseButtonNameParam(g),h=this;a.each(f,function(j,k){h.__alterButtons(f[j],function(i){i.removeClass("hidden")})});return this},eventSupported:function(f){var g=f in this.$element;if(!g){this.$element.setAttribute(f,"return;");g=typeof this.$element[f]==="function"}return g},keyup:function(h){var f=false;switch(h.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:var i;if(i=this.getNextTab(),i!==null){var j=this;setTimeout(function(){j.setSelection(i.start,i.end)},500);f=true}else{var g=this.getSelection();if(g.start==g.end&&g.end==this.getContent().length){f=false}else{this.setSelection(this.getContent().length,this.getContent().length);f=true}}break;case 13:f=false;break;case 27:if(this.$isFullscreen){this.setFullscreen(false)}f=false;break;default:f=false}if(f){h.stopPropagation();h.preventDefault()}this.$options.onChange(this)},change:function(f){this.$options.onChange(this);return this},select:function(f){this.$options.onSelect(this);return this},focus:function(f){var i=this.$options,h=i.hideable,g=this.$editor;g.addClass("active");a(document).find(".md-editor").each(function(){if(a(this).attr("id")!==g.attr("id")){var j;if(j=a(this).find("textarea").data("markdown"),j===null){j=a(this).find('div[data-provider="markdown-preview"]').data("markdown")}if(j){j.blur()}}});i.onFocus(this);return this},blur:function(h){var m=this.$options,k=m.hideable,j=this.$editor,i=this.$editable;if(j.hasClass("active")||this.$element.parent().length===0){j.removeClass("active");if(k){if(i.el!==null){var l=a("<"+i.type+"/>"),f=this.getContent(),g=this.parseContent(f);a(i.attrKeys).each(function(n,o){l.attr(i.attrKeys[n],i.attrValues[n])});l.html(g);j.replaceWith(l)}else{j.hide()}}m.onBlur(this)}return this}};var e=a.fn.markdown;a.fn.markdown=function(f){return this.each(function(){var g=a(this),h=g.data("markdown"),i=typeof f=="object"&&f;if(!h){g.data("markdown",(h=new d(this,i)))}})};a.fn.markdown.messages={};a.fn.markdown.defaults={autofocus:false,hideable:false,savable:false,width:"inherit",height:"inherit",resize:"none",iconlibrary:"glyph",language:"en",initialstate:"editor",parser:null,buttons:[[{name:"groupFont",data:[{name:"cmdBold",hotkey:"Ctrl+B",title:"Bold",icon:{glyph:"glyphicon glyphicon-bold",fa:"fa fa-bold","fa-3":"icon-bold"},callback:function(i){var f,h,j=i.getSelection(),g=i.getContent();if(j.length===0){f=i.__localize("strong text")}else{f=j.text}if(g.substr(j.start-2,2)==="**"&&g.substr(j.end,2)==="**"){i.setSelection(j.start-2,j.end+2);i.replaceSelection(f);h=j.start-2}else{i.replaceSelection("**"+f+"**");h=j.start+2}i.setSelection(h,h+f.length)}},{name:"cmdItalic",title:"Italic",hotkey:"Ctrl+I",icon:{glyph:"glyphicon glyphicon-italic",fa:"fa fa-italic","fa-3":"icon-italic"},callback:function(i){var f,h,j=i.getSelection(),g=i.getContent();if(j.length===0){f=i.__localize("emphasized text")}else{f=j.text}if(g.substr(j.start-1,1)==="_"&&g.substr(j.end,1)==="_"){i.setSelection(j.start-1,j.end+1);i.replaceSelection(f);h=j.start-1}else{i.replaceSelection("_"+f+"_");h=j.start+1}i.setSelection(h,h+f.length)}},{name:"cmdHeading",title:"Heading",hotkey:"Ctrl+H",icon:{glyph:"glyphicon glyphicon-header",fa:"fa fa-header","fa-3":"icon-font"},callback:function(i){var f,h,l=i.getSelection(),g=i.getContent(),j,k;if(l.length===0){f=i.__localize("heading text")}else{f=l.text+"\n"}if((j=4,g.substr(l.start-j,j)==="### ")||(j=3,g.substr(l.start-j,j)==="###")){i.setSelection(l.start-j,l.end);i.replaceSelection(f);h=l.start-j}else{if(l.start>0&&(k=g.substr(l.start-1,1),!!k&&k!="\n")){i.replaceSelection("\n\n### "+f);h=l.start+6}else{i.replaceSelection("### "+f);h=l.start+4}}i.setSelection(h,h+f.length)}}]},{name:"groupLink",data:[{name:"cmdUrl",title:"URL/Link",hotkey:"Ctrl+L",icon:{glyph:"glyphicon glyphicon-link",fa:"fa fa-link","fa-3":"icon-link"},callback:function(i){var f,h,l=i.getSelection(),g=i.getContent(),j;if(l.length===0){f=i.__localize("enter link description here")}else{f=l.text}j=prompt(i.__localize("Insert Hyperlink"),"http://");var m=new RegExp("^((http|https)://|(mailto:)|(//))[a-z0-9]","i");if(j!==null&&j!==""&&j!=="http://"&&m.test(j)){var k=a("<div>"+j+"</div>").text();i.replaceSelection("["+f+"]("+k+")");h=l.start+1;i.setSelection(h,h+f.length)}}},{name:"cmdImage",title:"Image",hotkey:"Ctrl+G",icon:{glyph:"glyphicon glyphicon-picture",fa:"fa fa-picture-o","fa-3":"icon-picture"},callback:function(i){var f,h,l=i.getSelection(),g=i.getContent(),j;if(l.length===0){f=i.__localize("enter image description here")}else{f=l.text}j=prompt(i.__localize("Insert Image Hyperlink"),"http://");var m=new RegExp("^((http|https)://|(//))[a-z0-9]","i");if(j!==null&&j!==""&&j!=="http://"&&m.test(j)){var k=a("<div>"+j+"</div>").text();i.replaceSelection("!["+f+"]("+k+' "'+i.__localize("enter image title here")+'")');h=l.start+2;i.setNextTab(i.__localize("enter image title here"));i.setSelection(h,h+f.length)}}}]},{name:"groupMisc",data:[{name:"cmdList",hotkey:"Ctrl+U",title:"Unordered List",icon:{glyph:"glyphicon glyphicon-list",fa:"fa fa-list","fa-3":"icon-list-ul"},callback:function(i){var f,h,k=i.getSelection(),g=i.getContent();if(k.length===0){f=i.__localize("list text here");i.replaceSelection("- "+f);h=k.start+2}else{if(k.text.indexOf("\n")<0){f=k.text;i.replaceSelection("- "+f);h=k.start+2}else{var j=[];j=k.text.split("\n");f=j[0];a.each(j,function(l,m){j[l]="- "+m});i.replaceSelection("\n\n"+j.join("\n"));h=k.start+4}}i.setSelection(h,h+f.length)}},{name:"cmdListO",hotkey:"Ctrl+O",title:"Ordered List",icon:{glyph:"glyphicon glyphicon-th-list",fa:"fa fa-list-ol","fa-3":"icon-list-ol"},callback:function(i){var f,h,k=i.getSelection(),g=i.getContent();if(k.length===0){f=i.__localize("list text here");i.replaceSelection("1. "+f);h=k.start+3}else{if(k.text.indexOf("\n")<0){f=k.text;i.replaceSelection("1. "+f);h=k.start+3}else{var j=[];j=k.text.split("\n");f=j[0];a.each(j,function(l,m){j[l]="1. "+m});i.replaceSelection("\n\n"+j.join("\n"));h=k.start+5}}i.setSelection(h,h+f.length)}},{name:"cmdCode",hotkey:"Ctrl+K",title:"Code",icon:{glyph:"glyphicon glyphicon-asterisk",fa:"fa fa-code","fa-3":"icon-code"},callback:function(i){var f,h,j=i.getSelection(),g=i.getContent();if(j.length===0){f=i.__localize("code text here")}else{f=j.text}if(g.substr(j.start-4,4)==="```\n"&&g.substr(j.end,4)==="\n```"){i.setSelection(j.start-4,j.end+4);i.replaceSelection(f);h=j.start-4}else{if(g.substr(j.start-1,1)==="`"&&g.substr(j.end,1)==="`"){i.setSelection(j.start-1,j.end+1);i.replaceSelection(f);h=j.start-1}else{if(g.indexOf("\n")>-1){i.replaceSelection("```\n"+f+"\n```");h=j.start+4}else{i.replaceSelection("`"+f+"`");h=j.start+1}}}i.setSelection(h,h+f.length)}},{name:"cmdQuote",hotkey:"Ctrl+Q",title:"Quote",icon:{glyph:"glyphicon glyphicon-comment",fa:"fa fa-quote-left","fa-3":"icon-quote-left"},callback:function(i){var f,h,k=i.getSelection(),g=i.getContent();if(k.length===0){f=i.__localize("quote here");i.replaceSelection("> "+f);h=k.start+2}else{if(k.text.indexOf("\n")<0){f=k.text;i.replaceSelection("> "+f);h=k.start+2}else{var j=[];j=k.text.split("\n");f=j[0];a.each(j,function(l,m){j[l]="> "+m});i.replaceSelection("\n\n"+j.join("\n"));h=k.start+4}}i.setSelection(h,h+f.length)}}]},{name:"groupUtil",data:[{name:"cmdPreview",toggle:true,hotkey:"Ctrl+P",title:"Preview",btnText:"Preview",btnClass:"btn btn-primary btn-sm",icon:{glyph:"glyphicon glyphicon-search",fa:"fa fa-search","fa-3":"icon-search"},callback:function(g){var h=g.$isPreview,f;if(h===false){g.showPreview()}else{g.hidePreview()}}}]}]],additionalButtons:[],reorderButtonGroups:[],hiddenButtons:[],disabledButtons:[],footer:"",fullscreen:{enable:true,icons:{fullscreenOn:{fa:"fa fa-expand",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-full"},fullscreenOff:{fa:"fa fa-compress",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-small"}}},onShow:function(f){},onPreview:function(f){},onSave:function(f){},onBlur:function(f){},onFocus:function(f){},onChange:function(f){},onFullscreen:function(f){},onSelect:function(f){}};a.fn.markdown.Constructor=d;a.fn.markdown.noConflict=function(){a.fn.markdown=e;return this};var c=function(g){var f=g;if(f.data("markdown")){f.data("markdown").showEditor();return}f.markdown()};var b=function(g){var f=a(document.activeElement);a(document).find(".md-editor").each(function(){var h=a(this),j=f.closest(".md-editor")[0]===this,i=h.find("textarea").data("markdown")||h.find('div[data-provider="markdown-preview"]').data("markdown");if(i&&!j){i.blur()}})};a(document).on("click.markdown.data-api",'[data-provide="markdown-editable"]',function(f){c(a(this));f.preventDefault()}).on("click focusin",function(f){b(f)}).ready(function(){a('textarea[data-provide="markdown"]').each(function(){c(a(this))})})}));