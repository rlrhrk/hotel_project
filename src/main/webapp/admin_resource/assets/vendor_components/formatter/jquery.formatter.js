/*
 * v0.1.5
 * Copyright (c) 2014 First Opinion
 * formatter.js is open sourced under the MIT license.
 *
 * thanks to digitalBush/jquery.maskedinput for some of the trickier
 * keycode handling
 */
(function(b,a){if(typeof define==="function"&&define.amd){define(["jQuery"],a)}else{if(typeof exports==="object"){a(require("jQuery"))}else{a(b.jQuery)}}}(this,function(c){var d=function(){var j={};var h=4;var k=new RegExp("{{([^}]+)}}","g");var i=function(n){var m=[],l;while(l=k.exec(n)){m.push(l)}return m};j.parse=function(q){var n={inpts:{},chars:{}};var o=i(q),r=q.length;var p=0,m=0,l=0;var s=function(u){var v=u.length;for(var t=0;t<v;t++){n.inpts[m]=u.charAt(t);m++}p++;l+=u.length+h-1};for(l;l<r;l++){if(p<o.length&&l===o[p].index){s(o[p][1])}else{n.chars[l-p*h]=q.charAt(l)}}n.mLength=l-p*h;return n};return j}();var g=function(){var i={};var h=typeof navigator!=="undefined"?navigator.userAgent:null;i.extend=function(j){for(var k=1;k<arguments.length;k++){for(var l in arguments[k]){j[l]=arguments[k][l]}}return j};i.addChars=function(l,j,k){return l.substr(0,k)+j+l.substr(k,l.length)};i.removeChars=function(l,k,j){return l.substr(0,k)+l.substr(j,l.length)};i.isBetween=function(k,j){j.sort(function(l,m){return l-m});return k>j[0]&&k<j[1]};i.addListener=function(j,k,l){return typeof j.addEventListener!=="undefined"?j.addEventListener(k,l,false):j.attachEvent("on"+k,l)};i.preventDefault=function(j){return j.preventDefault?j.preventDefault():j.returnValue=false};i.getClip=function(j){if(j.clipboardData){return j.clipboardData.getData("Text")}if(window.clipboardData){return window.clipboardData.getData("Text")}};i.getMatchingKey=function(o,m,n){for(var j in n){var l=n[j];if(o===l.which&&m===l.keyCode){return j}}};i.isDelKeyDown=function(l,j){var k={backspace:{which:8,keyCode:8},"delete":{which:46,keyCode:46}};return i.getMatchingKey(l,j,k)};i.isDelKeyPress=function(l,j){var k={backspace:{which:8,keyCode:8,shiftKey:false},"delete":{which:0,keyCode:46}};return i.getMatchingKey(l,j,k)};i.isSpecialKeyPress=function(l,j){var k={tab:{which:0,keyCode:9},enter:{which:13,keyCode:13},end:{which:0,keyCode:35},home:{which:0,keyCode:36},leftarrow:{which:0,keyCode:37},uparrow:{which:0,keyCode:38},rightarrow:{which:0,keyCode:39},downarrow:{which:0,keyCode:40},F5:{which:116,keyCode:116}};return i.getMatchingKey(l,j,k)};i.isModifier=function(j){return j.ctrlKey||j.altKey||j.metaKey};i.forEach=function(k,j,o){if(k.hasOwnProperty("length")){for(var l=0,n=k.length;l<n;l++){if(j.call(o,k[l],l,k)===false){break}}}else{for(var m in k){if(k.hasOwnProperty(m)){if(j.call(o,k[m],m,k)===false){break}}}}};return i}();var e=function(i,k){var h=function(l){if(l==="*"){return/.*/}return new RegExp(l)};function j(o){var m=[],n=[];k.forEach(o,function(p){k.forEach(p,function(s,q){var r=i.parse(s),t=h(q);m.push(t);n.push(r);return false})});var l=function(p){var q;k.forEach(m,function(s,r){if(s.test(p)){q=r;return false}});return q===undefined?null:n[q]};return{getPattern:l,patterns:n,matchers:m}}return j}(d,g);var b=function(){var h={};h.get=function(i){if(typeof i.selectionStart==="number"){return{begin:i.selectionStart,end:i.selectionEnd}}var m=document.selection.createRange();if(m&&m.parentElement()===i){var k=i.createTextRange(),j=i.createTextRange(),l=i.value.length;k.moveToBookmark(m.getBookmark());j.collapse(false);if(k.compareEndPoints("StartToEnd",j)>-1){return{begin:l,end:l}}return{begin:-k.moveStart("character",-l),end:-k.moveEnd("character",-l)}}return{begin:0,end:0}};h.set=function(i,j){if(typeof j!=="object"){j={begin:j,end:j}}if(i.setSelectionRange){i.focus();i.setSelectionRange(j.begin,j.end)}else{if(i.createTextRange){var k=i.createTextRange();k.collapse(true);k.moveEnd("character",j.end);k.moveStart("character",j.begin);k.select()}}};return h}();var a=function(l,k,m){var h={persistent:false,repeat:false,placeholder:" "};var j={"9":/[0-9]/,a:/[A-Za-z]/,"*":/[A-Za-z0-9]/};function i(n,o){var p=this;p.el=n;if(!p.el){throw new TypeError("Must provide an existing element")}p.opts=m.extend({},h,o);if(typeof p.opts.pattern!=="undefined"){p.opts.patterns=p._specFromSinglePattern(p.opts.pattern);delete p.opts.pattern}if(typeof p.opts.patterns==="undefined"){throw new TypeError("Must provide a pattern or array of patterns")}p.patternMatcher=l(p.opts.patterns);p._updatePattern();p.hldrs={};p.focus=0;m.addListener(p.el,"keydown",function(q){p._keyDown(q)});m.addListener(p.el,"keypress",function(q){p._keyPress(q)});m.addListener(p.el,"paste",function(q){p._paste(q)});if(p.opts.persistent){p._processKey("",false);p.el.blur();m.addListener(p.el,"focus",function(q){p._focus(q)});m.addListener(p.el,"click",function(q){p._focus(q)});m.addListener(p.el,"touchstart",function(q){p._focus(q)})}}i.addInptType=function(n,o){j[n]=o};i.prototype.resetPattern=function(o){this.opts.patterns=o?this._specFromSinglePattern(o):this.opts.patterns;this.sel=k.get(this.el);this.val=this.el.value;this.delta=0;this._removeChars();this.patternMatcher=l(this.opts.patterns);var n=this.patternMatcher.getPattern(this.val);this.mLength=n.mLength;this.chars=n.chars;this.inpts=n.inpts;this._processKey("",false,true)};i.prototype._updatePattern=function(){var n=this.patternMatcher.getPattern(this.val);if(n){this.mLength=n.mLength;this.chars=n.chars;this.inpts=n.inpts}};i.prototype._keyDown=function(n){var o=n.which||n.keyCode;if(o&&m.isDelKeyDown(n.which,n.keyCode)){this._processKey(null,o);return m.preventDefault(n)}};i.prototype._keyPress=function(n){var p,o;p=n.which||n.keyCode;o=m.isSpecialKeyPress(n.which,n.keyCode);if(!m.isDelKeyPress(n.which,n.keyCode)&&!o&&!m.isModifier(n)){this._processKey(String.fromCharCode(p),false);return m.preventDefault(n)}};i.prototype._paste=function(n){this._processKey(m.getClip(n),false);return m.preventDefault(n)};i.prototype._focus=function(){var n=this;setTimeout(function(){var q=k.get(n.el);var o=q.end>n.focus,p=q.end===0;if(o||p){k.set(n.el,n.focus)}},0)};i.prototype._processKey=function(n,o,p){this.sel=k.get(this.el);this.val=this.el.value;this.delta=0;if(this.sel.begin!==this.sel.end){this.delta=-1*Math.abs(this.sel.begin-this.sel.end);this.val=m.removeChars(this.val,this.sel.begin,this.sel.end)}else{if(o&&o===46){this._delete()}else{if(o&&this.sel.begin-1>=0){this.val=m.removeChars(this.val,this.sel.end-1,this.sel.end);this.delta-=1}else{if(o){return true}}}}if(!o){this.val=m.addChars(this.val,n,this.sel.begin);this.delta+=n.length}this._formatValue(p)};i.prototype._delete=function(){while(this.chars[this.sel.begin]){this._nextPos()}if(this.sel.begin<this.val.length){this._nextPos();this.val=m.removeChars(this.val,this.sel.end-1,this.sel.end);this.delta=-1}};i.prototype._nextPos=function(){this.sel.end++;this.sel.begin++};i.prototype._formatValue=function(n){this.newPos=this.sel.end+this.delta;this._removeChars();this._updatePattern();this._validateInpts();this._addChars();this.el.value=this.val.substr(0,this.mLength);if(typeof n==="undefined"||n===false){k.set(this.el,this.newPos)}};i.prototype._removeChars=function(){if(this.sel.end>this.focus){this.delta+=this.sel.end-this.focus}var r=0;for(var p=0;p<=this.mLength;p++){var n=this.chars[p],o=this.hldrs[p],q=p+r,s;q=p>=this.sel.begin?q+this.delta:q;s=this.val.charAt(q);if(n&&n===s||o&&o===s){this.val=m.removeChars(this.val,q,q+1);r--}}this.hldrs={};this.focus=this.val.length};i.prototype._validateInpts=function(){for(var n=0;n<this.val.length;n++){var p=this.inpts[n];var q=!j[p],r=!q&&!j[p].test(this.val.charAt(n)),o=this.inpts[n];if((q||r)&&o){this.val=m.removeChars(this.val,n,n+1);this.focusStart--;this.newPos--;this.delta--;n--}}};i.prototype._addChars=function(){if(this.opts.persistent){for(var n=0;n<=this.mLength;n++){if(!this.val.charAt(n)){this.val=m.addChars(this.val,this.opts.placeholder,n);this.hldrs[n]=this.opts.placeholder}this._addChar(n)}while(this.chars[this.focus]){this.focus++}}else{for(var o=0;o<=this.val.length;o++){if(this.delta<=0&&o===this.focus){return true}this._addChar(o)}}};i.prototype._addChar=function(o){var n=this.chars[o];if(!n){return true}if(m.isBetween(o,[this.sel.begin-1,this.newPos+1])){this.newPos++;this.delta++}if(o<=this.focus){this.focus++}if(this.hldrs[o]){delete this.hldrs[o];this.hldrs[o+1]=this.opts.placeholder}this.val=m.addChars(this.val,n,o)};i.prototype._specFromSinglePattern=function(n){return[{"*":n}]};return i}(e,b,g);var f="formatter";$.fn[f]=function(h){if(typeof h=="object"){this.each(function(){if(!$.data(this,"plugin_"+f)){$.data(this,"plugin_"+f,new a(this,h))}})}this.resetPattern=function(i){this.each(function(){var j=$.data(this,"plugin_"+f);if(j){j.resetPattern(i)}});return this};return this};$.fn[f].addInptType=function(h,i){a.addInptType(h,i)}}));