/*
 * v0.1.5
 * Copyright (c) 2014 First Opinion
 * formatter.js is open sourced under the MIT license.
 *
 * thanks to digitalBush/jquery.maskedinput for some of the trickier
 * keycode handling
 */
(function(b,a){if(typeof define==="function"&&define.amd){define([],function(){return(b.returnExportsGlobal=a())})}else{if(typeof exports==="object"){module.exports=a()}else{b.Formatter=a()}}}(this,function(){var c=function(){var h={};var f=4;var i=new RegExp("{{([^}]+)}}","g");var g=function(l){var k=[],j;while(j=i.exec(l)){k.push(j)}return k};h.parse=function(o){var l={inpts:{},chars:{}};var m=g(o),p=o.length;var n=0,k=0,j=0;var q=function(s){var t=s.length;for(var r=0;r<t;r++){l.inpts[k]=s.charAt(r);k++}n++;j+=s.length+f-1};for(j;j<p;j++){if(n<m.length&&j===m[n].index){q(m[n][1])}else{l.chars[j-n*f]=o.charAt(j)}}l.mLength=j-n*f;return l};return h}();var e=function(){var g={};var f=typeof navigator!=="undefined"?navigator.userAgent:null;g.extend=function(h){for(var j=1;j<arguments.length;j++){for(var k in arguments[j]){h[k]=arguments[j][k]}}return h};g.addChars=function(j,h,i){return j.substr(0,i)+h+j.substr(i,j.length)};g.removeChars=function(j,i,h){return j.substr(0,i)+j.substr(h,j.length)};g.isBetween=function(i,h){h.sort(function(j,k){return j-k});return i>h[0]&&i<h[1]};g.addListener=function(h,i,j){return typeof h.addEventListener!=="undefined"?h.addEventListener(i,j,false):h.attachEvent("on"+i,j)};g.preventDefault=function(h){return h.preventDefault?h.preventDefault():h.returnValue=false};g.getClip=function(h){if(h.clipboardData){return h.clipboardData.getData("Text")}if(window.clipboardData){return window.clipboardData.getData("Text")}};g.getMatchingKey=function(m,j,l){for(var h in l){var i=l[h];if(m===i.which&&j===i.keyCode){return h}}};g.isDelKeyDown=function(j,h){var i={backspace:{which:8,keyCode:8},"delete":{which:46,keyCode:46}};return g.getMatchingKey(j,h,i)};g.isDelKeyPress=function(j,h){var i={backspace:{which:8,keyCode:8,shiftKey:false},"delete":{which:0,keyCode:46}};return g.getMatchingKey(j,h,i)};g.isSpecialKeyPress=function(j,h){var i={tab:{which:0,keyCode:9},enter:{which:13,keyCode:13},end:{which:0,keyCode:35},home:{which:0,keyCode:36},leftarrow:{which:0,keyCode:37},uparrow:{which:0,keyCode:38},rightarrow:{which:0,keyCode:39},downarrow:{which:0,keyCode:40},F5:{which:116,keyCode:116}};return g.getMatchingKey(j,h,i)};g.isModifier=function(h){return h.ctrlKey||h.altKey||h.metaKey};g.forEach=function(i,h,m){if(i.hasOwnProperty("length")){for(var j=0,l=i.length;j<l;j++){if(h.call(m,i[j],j,i)===false){break}}}else{for(var k in i){if(i.hasOwnProperty(k)){if(h.call(m,i[k],k,i)===false){break}}}}};return g}();var d=function(g,i){var f=function(j){if(j==="*"){return/.*/}return new RegExp(j)};function h(m){var k=[],l=[];i.forEach(m,function(n){i.forEach(n,function(q,o){var p=g.parse(q),r=f(o);k.push(r);l.push(p);return false})});var j=function(n){var o;i.forEach(k,function(q,p){if(q.test(n)){o=p;return false}});return o===undefined?null:l[o]};return{getPattern:j,patterns:l,matchers:k}}return h}(c,e);var b=function(){var f={};f.get=function(g){if(typeof g.selectionStart==="number"){return{begin:g.selectionStart,end:g.selectionEnd}}var k=document.selection.createRange();if(k&&k.parentElement()===g){var i=g.createTextRange(),h=g.createTextRange(),j=g.value.length;i.moveToBookmark(k.getBookmark());h.collapse(false);if(i.compareEndPoints("StartToEnd",h)>-1){return{begin:j,end:j}}return{begin:-i.moveStart("character",-j),end:-i.moveEnd("character",-j)}}return{begin:0,end:0}};f.set=function(g,h){if(typeof h!=="object"){h={begin:h,end:h}}if(g.setSelectionRange){g.focus();g.setSelectionRange(h.begin,h.end)}else{if(g.createTextRange){var i=g.createTextRange();i.collapse(true);i.moveEnd("character",h.end);i.moveStart("character",h.begin);i.select()}}};return f}();var a=function(j,i,k){var f={persistent:false,repeat:false,placeholder:" "};var h={"9":/[0-9]/,a:/[A-Za-z]/,"*":/[A-Za-z0-9]/};function g(l,m){var n=this;n.el=l;if(!n.el){throw new TypeError("Must provide an existing element")}n.opts=k.extend({},f,m);if(typeof n.opts.pattern!=="undefined"){n.opts.patterns=n._specFromSinglePattern(n.opts.pattern);delete n.opts.pattern}if(typeof n.opts.patterns==="undefined"){throw new TypeError("Must provide a pattern or array of patterns")}n.patternMatcher=j(n.opts.patterns);n._updatePattern();n.hldrs={};n.focus=0;k.addListener(n.el,"keydown",function(o){n._keyDown(o)});k.addListener(n.el,"keypress",function(o){n._keyPress(o)});k.addListener(n.el,"paste",function(o){n._paste(o)});if(n.opts.persistent){n._processKey("",false);n.el.blur();k.addListener(n.el,"focus",function(o){n._focus(o)});k.addListener(n.el,"click",function(o){n._focus(o)});k.addListener(n.el,"touchstart",function(o){n._focus(o)})}}g.addInptType=function(l,m){h[l]=m};g.prototype.resetPattern=function(m){this.opts.patterns=m?this._specFromSinglePattern(m):this.opts.patterns;this.sel=i.get(this.el);this.val=this.el.value;this.delta=0;this._removeChars();this.patternMatcher=j(this.opts.patterns);var l=this.patternMatcher.getPattern(this.val);this.mLength=l.mLength;this.chars=l.chars;this.inpts=l.inpts;this._processKey("",false,true)};g.prototype._updatePattern=function(){var l=this.patternMatcher.getPattern(this.val);if(l){this.mLength=l.mLength;this.chars=l.chars;this.inpts=l.inpts}};g.prototype._keyDown=function(l){var m=l.which||l.keyCode;if(m&&k.isDelKeyDown(l.which,l.keyCode)){this._processKey(null,m);return k.preventDefault(l)}};g.prototype._keyPress=function(l){var n,m;n=l.which||l.keyCode;m=k.isSpecialKeyPress(l.which,l.keyCode);if(!k.isDelKeyPress(l.which,l.keyCode)&&!m&&!k.isModifier(l)){this._processKey(String.fromCharCode(n),false);return k.preventDefault(l)}};g.prototype._paste=function(l){this._processKey(k.getClip(l),false);return k.preventDefault(l)};g.prototype._focus=function(){var l=this;setTimeout(function(){var o=i.get(l.el);var m=o.end>l.focus,n=o.end===0;if(m||n){i.set(l.el,l.focus)}},0)};g.prototype._processKey=function(l,m,n){this.sel=i.get(this.el);this.val=this.el.value;this.delta=0;if(this.sel.begin!==this.sel.end){this.delta=-1*Math.abs(this.sel.begin-this.sel.end);this.val=k.removeChars(this.val,this.sel.begin,this.sel.end)}else{if(m&&m===46){this._delete()}else{if(m&&this.sel.begin-1>=0){this.val=k.removeChars(this.val,this.sel.end-1,this.sel.end);this.delta-=1}else{if(m){return true}}}}if(!m){this.val=k.addChars(this.val,l,this.sel.begin);this.delta+=l.length}this._formatValue(n)};g.prototype._delete=function(){while(this.chars[this.sel.begin]){this._nextPos()}if(this.sel.begin<this.val.length){this._nextPos();this.val=k.removeChars(this.val,this.sel.end-1,this.sel.end);this.delta=-1}};g.prototype._nextPos=function(){this.sel.end++;this.sel.begin++};g.prototype._formatValue=function(l){this.newPos=this.sel.end+this.delta;this._removeChars();this._updatePattern();this._validateInpts();this._addChars();this.el.value=this.val.substr(0,this.mLength);if(typeof l==="undefined"||l===false){i.set(this.el,this.newPos)}};g.prototype._removeChars=function(){if(this.sel.end>this.focus){this.delta+=this.sel.end-this.focus}var p=0;for(var n=0;n<=this.mLength;n++){var l=this.chars[n],m=this.hldrs[n],o=n+p,q;o=n>=this.sel.begin?o+this.delta:o;q=this.val.charAt(o);if(l&&l===q||m&&m===q){this.val=k.removeChars(this.val,o,o+1);p--}}this.hldrs={};this.focus=this.val.length};g.prototype._validateInpts=function(){for(var l=0;l<this.val.length;l++){var n=this.inpts[l];var o=!h[n],p=!o&&!h[n].test(this.val.charAt(l)),m=this.inpts[l];if((o||p)&&m){this.val=k.removeChars(this.val,l,l+1);this.focusStart--;this.newPos--;this.delta--;l--}}};g.prototype._addChars=function(){if(this.opts.persistent){for(var l=0;l<=this.mLength;l++){if(!this.val.charAt(l)){this.val=k.addChars(this.val,this.opts.placeholder,l);this.hldrs[l]=this.opts.placeholder}this._addChar(l)}while(this.chars[this.focus]){this.focus++}}else{for(var m=0;m<=this.val.length;m++){if(this.delta<=0&&m===this.focus){return true}this._addChar(m)}}};g.prototype._addChar=function(m){var l=this.chars[m];if(!l){return true}if(k.isBetween(m,[this.sel.begin-1,this.newPos+1])){this.newPos++;this.delta++}if(m<=this.focus){this.focus++}if(this.hldrs[m]){delete this.hldrs[m];this.hldrs[m+1]=this.opts.placeholder}this.val=k.addChars(this.val,l,m)};g.prototype._specFromSinglePattern=function(l){return[{"*":l}]};return g}(d,b,e);return a}));